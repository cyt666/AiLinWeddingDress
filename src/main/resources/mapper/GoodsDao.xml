<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ailin.dao.GoodsDao">

    <resultMap id="goodsResult" type="com.ailin.model.Goods">
        <id column="goodsId" property="id" />
        <result column="putaway_time" property="putawayTime"/>
        <result column="goodsName" property="name"/>
        <result column="hemline" property="hemline"/>
        <result column="description" property="description"/>
        <result column="style" property="style"/>
        <result column="color" property="color"/>
        <result column="quantity" property="quantity"/>
        <result column="goodsSale_count" property="saleCount"/>
        <result column="weight" property="weight"/>
        <result column="status" property="status"/>
        <result column="price" property="price"/>
        <result column="image" property="image"/>
        <result column="shopId" property="shopId"/>
    </resultMap>
    
    <resultMap id="imageResult" type="com.ailin.model.GoodsImages" >
    <id column="imgId" property="id" jdbcType="INTEGER" />
    <result column="visibility" property="visibility" jdbcType="TINYINT" />
    <result column="goods_id" property="goodsId" jdbcType="INTEGER" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="position" property="position" jdbcType="INTEGER" />
</resultMap>

    <sql id="goodsById">
    tb_goods.id AS goodsId,
    tb_goods.name AS goodsName,
    tb_goods.hemline,tb_goods.description,
    tb_goods.style,
    tb_goods.color,tb_goods.quantity,
    tb_goods.sale_count AS goodsSale_count,
    tb_goods.weight,tb_goods.status,tb_goods.price,
    tb_goods_image.url AS image,
    tb_shop_goods_relation.shop_id AS shopId,
    </sql>

    <sql id="fromWhere">
     FROM tb_goods,tb_shop,tb_goods_image,tb_shop_goods_relation
        WHERE tb_goods.id=tb_shop_goods_relation.goods_id
        AND tb_goods_image.goods_id=tb_shop_goods_relation.goods_id
   </sql>
    <sql id="img">
         id AS imgId, goods_id, url, `position`
    </sql>
    <sql id="conditions">
        <if test="goodsName!=null">and tb_goods.name like '%${goodsName}%'</if>
        <if test="goodsStyle!=null">and tb_goods.style like '%${goodsStyle}%'</if>
        <if test="goodsHemline!=null">and tb_goods.hemline like '%${goodsHemline}%'</if>
        <if test="goodsDescription!=null">and tb_goods.description like '%${goodsDescription}%'</if>
    </sql>

    <sql id="order">
        <if test="order!=null and order==1"> order by tb_goods.price desc</if>
        <if test="order!=null and order==2">order by tb_goods.price</if>
        <if test="order!=null and order==3">order by tb_goods.sale_count desc</if>
        <if test="order!=null and order==4">order by tb_goods.weight desc</if>
    </sql>
    <sql id="fromWhere">
        FROM tb_goods,tb_shop,tb_goods_image,tb_shop_goods_relation
        WHERE tb_goods.id=tb_shop_goods_relation.goods_id
        AND tb_shop.id=tb_shop_goods_relation.shop_id
        AND tb_goods_image.goods_id=tb_shop_goods_relation.goods_id
    </sql>
    <!--根据商品id查商品信息-->
    <select id="selectGoodsById" parameterType="INTEGER" resultMap="goodsResult">
        SELECT
        <include refid="goods"/>
        FROM tb_goods,tb_goods_image
        WHERE tb_goods.id=tb_goods_image.goods_id
        AND tb_goods.id=#{goodsId}
        AND tb_goods_image.position=1
        AND tb_goods.visibility=0
    </select>
    <!--根据商品id查四张图片-->
    <select id="selectImageByGoodsId" parameterType="INTEGER" resultMap="imageResult">
        SELECT tb_goods_image.id,tb_goods_image.goods_id,tb_goods_image.url
        FROM tb_goods_image
        WHERE tb_goods_image.goods_id=#{imageId}
        AND tb_goods_image.visibility=0
    </select>
    <!--查询所有商品，按照要求筛选（name，或排序方式）-->
    <select id="selectAllGoods" resultMap="goodsResult" parameterType="java.util.HashMap">
        SELECT
        <include refid="goods"/>
        <include refid="fromWhere"/>
        AND tb_goods_image.position=1
        AND tb_goods.visibility=0
        AND 1=1
        <include refid="conditions"/>
        <include refid="order"/>
    </select>
</mapper>