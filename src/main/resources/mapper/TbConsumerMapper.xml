<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.ailin.dao.TbConsumerDao" >
    <resultMap id="BaseResultMap" type="com.ailin.model.TbConsumer" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
        <result column="last_update" property="lastUpdate" jdbcType="TIMESTAMP" />
        <result column="visibility" property="visibility" jdbcType="TINYINT" />
        <result column="user_name" property="userName" jdbcType="VARCHAR" />
        <result column="password" property="password" jdbcType="VARCHAR" />
        <result column="salt" property="salt" jdbcType="VARCHAR" />
        <result column="nick_name" property="nickName" jdbcType="VARCHAR" />
        <result column="head_img_url" property="headImgUrl" jdbcType="VARCHAR" />
        <result column="score" property="score" jdbcType="INTEGER" />
        <result column="wallet" property="wallet" jdbcType="DECIMAL" />
        <result column="gender" property="gender" jdbcType="VARCHAR" />
        <result column="email" property="email" jdbcType="VARCHAR" />
        <result column="telephone" property="telephone" jdbcType="VARCHAR" />
        <result column="birthday" property="birthday" jdbcType="TIMESTAMP" />
        <result column="default_address_id" property="defaultAddressId" jdbcType="INTEGER" />

        <collection property="tbAddresslist" javaType="com.ailin.model.TbAddress">
            <id column="id" property="id" jdbcType="INTEGER"/>
            <result column="visibility" property="visibility" jdbcType="TINYINT" />
            <result column="province" property="province" jdbcType="VARCHAR" />
            <result column="city" property="city" jdbcType="VARCHAR" />
            <result column="district" property="district" jdbcType="VARCHAR" />
            <result column="street" property="street" jdbcType="VARCHAR" />
            <result column="post" property="post" jdbcType="VARCHAR" />
            <result column="detail" property="detail" jdbcType="VARCHAR" />
            <result column="consumer_id" property="consumerId" jdbcType="INTEGER" />
            <result column="consumer_name" property="consumerName" jdbcType="VARCHAR" />
            <result column="consumer_phone" property="consumerPhone" jdbcType="VARCHAR" />
        </collection>
    </resultMap>

    <!--一个人有多个地址，查地址-->
    <select id="selectAddressAndConsumer" parameterType="java.lang.Integer" resultType="com.ailin.model.TbAddress" >
        select
        tbadd.visibility, tbadd.province, tbadd.city, tbadd.district, tbadd.street,
        tbadd.detail, tbadd.consumer_id as consumerId, tbadd.consumer_name as consumerName, tbadd.consumer_phone as consumerPhone
        from tb_address tbadd,tb_consumer tbcons
        where tbadd.consumer_id = tbcons.id
        and tbadd.consumer_id=#{consumerId}
    </select>

    <!-- 查客户的所有信息 -->
    <select id="selectAll" resultMap="BaseResultMap">
        select * from tb_consumer
    </select>


    <!-- 登录的方法，测试从用户表中能不能查到一个用户的所有地址 -->
    <select id="login" resultMap="BaseResultMap" parameterType="com.ailin.model.TbConsumer">
        select * from tb_consumer where user_name=#{userName} and password=#{password}
    </select>

    <!--修改个人资料-->
    <update id="updateByPrimaryKeySelective" parameterType="com.lmm.entity.TbConsumer" >
        update tb_consumer
        <set >
            <if test="createTime != null" >
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="lastUpdate != null" >
                last_update = #{lastUpdate,jdbcType=TIMESTAMP},
            </if>
            <if test="visibility != null" >
                visibility = #{visibility,jdbcType=TINYINT},
            </if>
            <if test="userName != null" >
                user_name = #{userName,jdbcType=VARCHAR},
            </if>
            <if test="password != null" >
                `password` = #{password,jdbcType=VARCHAR},
            </if>
            <if test="salt != null" >
                salt = #{salt,jdbcType=VARCHAR},
            </if>
            <if test="nickName != null" >
                nick_name = #{nickName,jdbcType=VARCHAR},
            </if>
            <if test="headImgUrl != null" >
                head_img_url = #{headImgUrl,jdbcType=VARCHAR},
            </if>
            <if test="score != null" >
                score = #{score,jdbcType=INTEGER},
            </if>
            <if test="wallet != null" >
                wallet = #{wallet,jdbcType=DECIMAL},
            </if>
            <if test="gender != null" >
                gender = #{gender,jdbcType=VARCHAR},
            </if>
            <if test="email != null" >
                email = #{email,jdbcType=VARCHAR},
            </if>
            <if test="telephone != null" >
                telephone = #{telephone,jdbcType=VARCHAR},
            </if>
            <if test="birthday != null" >
                birthday = #{birthday,jdbcType=TIMESTAMP},
            </if>
            <if test="defaultAddressId != null" >
                default_address_id = #{defaultAddressId,jdbcType=INTEGER},
            </if>
        </set>
        where id = #{id,jdbcType=INTEGER}
    </update>



</mapper>